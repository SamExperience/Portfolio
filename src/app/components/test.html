<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Test animation-timeline view()</title>
    <style>
      body {
        min-height: 300vh;
        margin: 0;
        font-family: sans-serif;
      }

      .spacer {
        height: 110vh;
      } /* forza scroll per far entrare l'elemento in vista */

      .box {
        width: 320px;
        margin: 0 auto;
        padding: 40px;
        background: coral;
        color: white;
        font-size: 18px;
        border-radius: 8px;

        /* keyframes collegati alla view timeline */
        animation-name: fadeInMove;
        animation-duration: 1s;
        animation-timing-function: ease-out;
        animation-fill-mode: both;
        animation-timeline: view();
        animation-range: entry 0% cover 50%;
      }

      @keyframes fadeInMove {
        from {
          opacity: 0;
          transform: translateY(40px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      /* fallback se animation-timeline non è supportato */
      @supports not (animation-timeline: view()) {
        .box {
          opacity: 0;
          transform: translateY(40px);
          transition: opacity 1s ease-out, transform 1s ease-out;
        }
        .box.in-view {
          opacity: 1;
          transform: translateY(0);
        }
      }
    </style>
  </head>
  <body>
    <div class="spacer"></div>
    <div class="box">Se vedi questa animazione legata allo scroll, funziona!</div>
    <div style="height: 100vh"></div>

    <script>
      // fallback automatico: aggiunge .in-view se animation-timeline non è disponibile
      if (!CSS.supports('animation-timeline: view()')) {
        const io = new IntersectionObserver(
          (entries) => {
            entries.forEach((e) => {
              if (e.isIntersecting) e.target.classList.add('in-view');
              else e.target.classList.remove('in-view');
            });
          },
          { threshold: 0.15 }
        );

        document.querySelectorAll('.box').forEach((el) => io.observe(el));
      }
    </script>
  </body>
</html>
